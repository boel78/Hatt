/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package hatt;

import java.util.ArrayList;
import java.util.HashMap;
import javax.swing.JOptionPane;
import javax.swing.JTextField;

/**
 *
 * @author joelnorling
 */
public class CreateOrderExistingCustomer extends javax.swing.JFrame {

    private String uid;
    private String hourlyRate;
    private String totalPrice;

    public CreateOrderExistingCustomer(String uid) {
        this.uid = uid;
        hourlyRate = "200";
        initComponents();
        lblExpress.setVisible(false);
        fillCobCustomers();
        fillCobRequestNames();
        fillCobStockedProducts();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        tfName = new javax.swing.JTextField();
        lblName = new javax.swing.JLabel();
        lblAddress = new javax.swing.JLabel();
        tfAddress = new javax.swing.JTextField();
        lblEmail = new javax.swing.JLabel();
        tfEmail = new javax.swing.JTextField();
        tfPhone = new javax.swing.JTextField();
        lblPhone = new javax.swing.JLabel();
        lblCustomerInfo = new javax.swing.JLabel();
        lblOrderInfo = new javax.swing.JLabel();
        lblDescription = new javax.swing.JLabel();
        tfFabric2 = new javax.swing.JTextField();
        tfFabric4 = new javax.swing.JTextField();
        tfFabric3 = new javax.swing.JTextField();
        tfFabric1 = new javax.swing.JTextField();
        lblMaterial = new javax.swing.JLabel();
        tfAccessories3 = new javax.swing.JTextField();
        tfAccessories1 = new javax.swing.JTextField();
        tfAccessories2 = new javax.swing.JTextField();
        tfAccessories4 = new javax.swing.JTextField();
        tfSize3 = new javax.swing.JTextField();
        tfSize1 = new javax.swing.JTextField();
        lblSize = new javax.swing.JLabel();
        tfAmount3 = new javax.swing.JTextField();
        tfAmount1 = new javax.swing.JTextField();
        tfAmount2 = new javax.swing.JTextField();
        tfAmount4 = new javax.swing.JTextField();
        tfSize2 = new javax.swing.JTextField();
        tfSize4 = new javax.swing.JTextField();
        tfEstimatedTime = new javax.swing.JTextField();
        lblEstimatedTime = new javax.swing.JLabel();
        lblAccessories = new javax.swing.JLabel();
        lblAmount = new javax.swing.JLabel();
        cobCustomers = new javax.swing.JComboBox<>();
        lblCustomers = new javax.swing.JLabel();
        tfDescription = new javax.swing.JTextField();
        btnConfirm = new javax.swing.JButton();
        lblStar = new javax.swing.JLabel();
        lblMandatory = new javax.swing.JLabel();
        btnGetRequestInfo = new javax.swing.JButton();
        lblRequestsForCustomer = new javax.swing.JLabel();
        lblRequests = new javax.swing.JLabel();
        cobRequestsForCustomer = new javax.swing.JComboBox<>();
        btnCalculate = new javax.swing.JButton();
        txtEstimatedPrice = new javax.swing.JTextField();
        lblPriceIncMoms = new javax.swing.JLabel();
        cbStockedProducts = new javax.swing.JComboBox<>();
        jLabel1 = new javax.swing.JLabel();
        txtStartingPrice = new javax.swing.JTextField();
        lblStartingPrice = new javax.swing.JLabel();
        lblPriceExMoms = new javax.swing.JLabel();
        txtPriceExMoms = new javax.swing.JTextField();
        lblExpress = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        tfName.setEditable(false);
        getContentPane().add(tfName, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 148, 170, -1));

        lblName.setText("Namn");
        getContentPane().add(lblName, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 125, -1, -1));

        lblAddress.setText("Adress");
        getContentPane().add(lblAddress, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 187, -1, -1));

        tfAddress.setEditable(false);
        getContentPane().add(tfAddress, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 210, 170, -1));

        lblEmail.setText("Epost");
        getContentPane().add(lblEmail, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 311, -1, -1));

        tfEmail.setEditable(false);
        getContentPane().add(tfEmail, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 334, 170, -1));

        tfPhone.setEditable(false);
        getContentPane().add(tfPhone, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 272, 170, -1));

        lblPhone.setText("Telefonnummer");
        getContentPane().add(lblPhone, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 249, -1, -1));

        lblCustomerInfo.setText("Kundinfo");
        getContentPane().add(lblCustomerInfo, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 29, -1, -1));

        lblOrderInfo.setText("Beställningsinfo");
        getContentPane().add(lblOrderInfo, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 29, -1, -1));

        lblDescription.setText("Beskrivning*");
        getContentPane().add(lblDescription, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 98, -1, -1));
        getContentPane().add(tfFabric2, new org.netbeans.lib.awtextra.AbsoluteConstraints(509, 297, 120, -1));
        getContentPane().add(tfFabric4, new org.netbeans.lib.awtextra.AbsoluteConstraints(509, 359, 120, -1));
        getContentPane().add(tfFabric3, new org.netbeans.lib.awtextra.AbsoluteConstraints(509, 330, 120, -1));
        getContentPane().add(tfFabric1, new org.netbeans.lib.awtextra.AbsoluteConstraints(509, 264, 120, -1));

        lblMaterial.setText("Tyg");
        getContentPane().add(lblMaterial, new org.netbeans.lib.awtextra.AbsoluteConstraints(509, 241, -1, -1));
        getContentPane().add(tfAccessories3, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 330, 120, -1));
        getContentPane().add(tfAccessories1, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 264, 120, -1));
        getContentPane().add(tfAccessories2, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 297, 120, -1));
        getContentPane().add(tfAccessories4, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 362, 120, -1));
        getContentPane().add(tfSize3, new org.netbeans.lib.awtextra.AbsoluteConstraints(641, 333, 39, -1));
        getContentPane().add(tfSize1, new org.netbeans.lib.awtextra.AbsoluteConstraints(641, 264, 39, -1));

        lblSize.setText("Storlek (cm2)");
        getContentPane().add(lblSize, new org.netbeans.lib.awtextra.AbsoluteConstraints(641, 241, -1, -1));
        getContentPane().add(tfAmount3, new org.netbeans.lib.awtextra.AbsoluteConstraints(416, 330, 39, -1));
        getContentPane().add(tfAmount1, new org.netbeans.lib.awtextra.AbsoluteConstraints(416, 264, 39, -1));
        getContentPane().add(tfAmount2, new org.netbeans.lib.awtextra.AbsoluteConstraints(416, 297, 39, -1));
        getContentPane().add(tfAmount4, new org.netbeans.lib.awtextra.AbsoluteConstraints(416, 362, 39, -1));
        getContentPane().add(tfSize2, new org.netbeans.lib.awtextra.AbsoluteConstraints(641, 300, 39, -1));
        getContentPane().add(tfSize4, new org.netbeans.lib.awtextra.AbsoluteConstraints(641, 362, 39, -1));
        getContentPane().add(tfEstimatedTime, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 195, 35, -1));

        lblEstimatedTime.setText("Estimerad tid*");
        getContentPane().add(lblEstimatedTime, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 172, -1, -1));

        lblAccessories.setText("Accessoarer");
        getContentPane().add(lblAccessories, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 241, -1, -1));

        lblAmount.setText("Antal (st)");
        getContentPane().add(lblAmount, new org.netbeans.lib.awtextra.AbsoluteConstraints(416, 241, -1, -1));

        cobCustomers.setEditable(true);
        cobCustomers.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cobCustomersActionPerformed(evt);
            }
        });
        getContentPane().add(cobCustomers, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 80, 170, -1));

        lblCustomers.setText("Befintlig kund");
        getContentPane().add(lblCustomers, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 58, -1, -1));
        getContentPane().add(tfDescription, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 127, 179, -1));

        btnConfirm.setText("Bekräfta order");
        btnConfirm.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnConfirmActionPerformed(evt);
            }
        });
        getContentPane().add(btnConfirm, new org.netbeans.lib.awtextra.AbsoluteConstraints(284, 436, -1, -1));

        lblStar.setText("*");
        getContentPane().add(lblStar, new org.netbeans.lib.awtextra.AbsoluteConstraints(686, 264, 22, 30));

        lblMandatory.setText("* är obligatoriska fält");
        getContentPane().add(lblMandatory, new org.netbeans.lib.awtextra.AbsoluteConstraints(24, 446, -1, -1));

        btnGetRequestInfo.setText("Hämta förfrågning");
        btnGetRequestInfo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGetRequestInfoActionPerformed(evt);
            }
        });
        getContentPane().add(btnGetRequestInfo, new org.netbeans.lib.awtextra.AbsoluteConstraints(509, 91, -1, -1));

        lblRequestsForCustomer.setText("Förfrågningar tillhörande kund");
        getContentPane().add(lblRequestsForCustomer, new org.netbeans.lib.awtextra.AbsoluteConstraints(480, 29, -1, -1));

        lblRequests.setText("Förfrågningar:");
        getContentPane().add(lblRequests, new org.netbeans.lib.awtextra.AbsoluteConstraints(472, 63, -1, -1));

        getContentPane().add(cobRequestsForCustomer, new org.netbeans.lib.awtextra.AbsoluteConstraints(569, 58, -1, -1));

        btnCalculate.setText("Beräkna pris");
        btnCalculate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCalculateActionPerformed(evt);
            }
        });
        getContentPane().add(btnCalculate, new org.netbeans.lib.awtextra.AbsoluteConstraints(430, 436, -1, -1));

        txtEstimatedPrice.setColumns(10);
        getContentPane().add(txtEstimatedPrice, new org.netbeans.lib.awtextra.AbsoluteConstraints(578, 436, -1, -1));

        lblPriceIncMoms.setText("Pris ink. moms");
        getContentPane().add(lblPriceIncMoms, new org.netbeans.lib.awtextra.AbsoluteConstraints(578, 413, -1, -1));

        cbStockedProducts.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                cbStockedProductsItemStateChanged(evt);
            }
        });
        getContentPane().add(cbStockedProducts, new org.netbeans.lib.awtextra.AbsoluteConstraints(734, 91, -1, -1));

        jLabel1.setText("Lagerförda modeller");
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(710, 63, -1, -1));

        txtStartingPrice.setColumns(7);
        getContentPane().add(txtStartingPrice, new org.netbeans.lib.awtextra.AbsoluteConstraints(723, 187, -1, -1));

        lblStartingPrice.setText("Utgångspris:");
        getContentPane().add(lblStartingPrice, new org.netbeans.lib.awtextra.AbsoluteConstraints(736, 153, -1, -1));

        lblPriceExMoms.setText("Pris ex. moms");
        getContentPane().add(lblPriceExMoms, new org.netbeans.lib.awtextra.AbsoluteConstraints(744, 413, -1, -1));

        txtPriceExMoms.setColumns(10);
        getContentPane().add(txtPriceExMoms, new org.netbeans.lib.awtextra.AbsoluteConstraints(744, 436, -1, -1));

        lblExpress.setForeground(new java.awt.Color(255, 0, 0));
        lblExpress.setText("* +25% expressbeställning");
        getContentPane().add(lblExpress, new org.netbeans.lib.awtextra.AbsoluteConstraints(630, 400, -1, -1));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    //Returns the value in the combobox and makes it into a string
    private String getCustomerEmail() {
        return cobCustomers.getSelectedItem().toString();
    }

    private void cobCustomersActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cobCustomersActionPerformed

        //Fills the textfields with information about the chosen customer
        String customerEmail = getCustomerEmail();

        String name = Database.fetchSingle("name", "customer", "Email", customerEmail);
        String address = Database.fetchSingle("address", "customer", "Email", customerEmail);
        String phone = Database.fetchSingle("phone", "customer", "Email", customerEmail);

        tfName.setText(name);
        tfAddress.setText(address);
        tfPhone.setText(phone);
        tfEmail.setText(customerEmail);

        //Fills the requestcombobox depending on the chosen customer
        fillCobRequestNames();
    }//GEN-LAST:event_cobCustomersActionPerformed

    private void btnConfirmActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnConfirmActionPerformed
        calcPriceTotal();
        ArrayList<String> fabrics = getFabricsTf();
        ArrayList<String> accessories = getAccessoriesTf();
        if (Validation.hasValueMandatory(tfName) && Validation.hasValueMandatory(tfDescription) && Validation.hasValueMandatory(tfEstimatedTime) && Validation.hasValueMandatory(tfFabric1) && Validation.hasValueTwoFields(tfAccessories1, tfAmount1) && Validation.hasValueTwoFields(tfAccessories2, tfAmount2) && Validation.hasValueTwoFields(tfAccessories3, tfAmount3) && Validation.hasValueTwoFields(tfAccessories4, tfAmount4) && Validation.hasValueTwoFields(tfFabric1, tfSize1) && Validation.hasValueTwoFields(tfFabric2, tfSize2) && Validation.hasValueTwoFields(tfFabric3, tfSize3) && Validation.hasValueTwoFields(tfFabric4, tfSize4)) {
            if (Validation.fabricValidation(fabrics) && Validation.accessoryValidation(accessories) && Validation.isDoubleErrorMessage(tfEstimatedTime) && Validation.validateDescription(tfDescription) && Validation.isDoubleIfNotEmpty(tfAmount1) && Validation.isDoubleIfNotEmpty(tfAmount2) && Validation.isDoubleIfNotEmpty(tfAmount3) && Validation.isDoubleIfNotEmpty(tfAmount4) && Validation.isDoubleIfNotEmpty(tfSize1) && Validation.isDoubleIfNotEmpty(tfSize2) && Validation.isDoubleIfNotEmpty(tfSize3) && Validation.isDoubleIfNotEmpty(tfSize4)) {

                //Fetches the customer info based on the choice in the combobox
                String customerEmail = getCustomerEmail();
                String customerID = Database.fetchSingle("cid", "customer", "Email", customerEmail);

                //Fetches the description and time for ordering a hat
                String description = tfDescription.getText();
                double estimatedTime = Double.parseDouble(tfEstimatedTime.getText());

                //Creates a new orderID
                String orderID = Database.getAutoIncrement("xOrder", "oid");

                //Creates the order
                String orderColumns = "(oid, description, estimated_time, created_by, customer, price, ordertype)";
                String ordeValues = "(" + orderID + ",'" + description + "'," + estimatedTime + "," + uid + "," + customerID + "," + totalPrice + ",'" + "J" + "')";
                Database.insert("xorder", orderColumns, ordeValues);

                //Fetches the fabrics and accessories
                HashMap<String, String> accessoriesAmounts = getAccessoriesWithAmount();
                HashMap<String, String> fabricSizes = getFabricsWithSize();

                //Loops trough the fabrics
                for (String fabricMaterials : fabricSizes.keySet()) {
                    String fabricMid = Database.fetchSingle("mid", "materials", "name", fabricMaterials);
                    String fabricAmount = fabricSizes.get(fabricMaterials);

                    //Checks if amount is 0 in db, if so order materials
                    String fetch = Database.fetchSingle("size", "fabric", "mid", fabricMid);
                    Double x = Double.parseDouble(fetch);
                    Double y = Double.parseDouble(fabricAmount);
                    Double z = x - y;
                    System.out.println("ZZZZZ" + z);
                    if (z <= 0) {
                        Double sum = 0 - z;
                        System.out.println("SUMMMMM" + sum);

                        int result = JOptionPane.showConfirmDialog(null, "Det finns inte tillräckligt med material, vill du beställa mer?", "Swing Tester",
                                JOptionPane.YES_NO_OPTION,
                                JOptionPane.QUESTION_MESSAGE);
                        if (result == JOptionPane.YES_OPTION) {
                            registerOrderedMaterial rom = new registerOrderedMaterial(uid);
                            String price = rom.calculatePrice(fabricMid, sum.toString());
                            System.out.println("PIRIIIICE" + price);
                            String oid = Database.getAutoIncrement("xorder", "oid");
                            rom.createMaterialOrder(oid, fabricMaterials, price, uid);

                            String query = "UPDATE fabric set size = " + "0.0" + "where mid = " + fabricMid;
                            Database.updatePreparedQuery(query);
                        } else if (result == JOptionPane.NO_OPTION) {

                        }
                    } else {
                        String query = "UPDATE fabric set size = " + z + "where mid = " + fabricMid;
                        Database.updatePreparedQuery(query);
                    }

                    //Adds the orderID, materialID and the amount to "order_consists_of_materials"
                    String consistsOfColumns = "(oid, mid, amount)";
                    String cosistsOfValues = "(" + orderID + "," + fabricMid + "," + fabricAmount + ")";
                    Database.insert("order_consists_of_materials", consistsOfColumns, cosistsOfValues);
                }

                //Loops trough the accessories
                for (String accessoriesMaterials : accessoriesAmounts.keySet()) {
                    String accessoriesMid = Database.fetchSingle("mid", "materials", "name", accessoriesMaterials);
                    String accessoriesAmount = accessoriesAmounts.get(accessoriesMaterials);

                    //Adds the orderID, materialID and the amount to "order_consists_of_materials"
                    String consistsOfColumns = "(oid, mid, amount)";
                    String cosistsOfValues = "(" + orderID + "," + accessoriesMid + "," + accessoriesAmount + ")";
                    Database.insert("order_consists_of_materials", consistsOfColumns, cosistsOfValues);
                    
                    //Checks if amount is 0 in db, if so order materials
                    String fetch = Database.fetchSingle("amount", "accessories", "mid", accessoriesMid);
                    Double x = Double.parseDouble(fetch);
                    Double y = Double.parseDouble(accessoriesAmount);
                    Double z = x - y;
                    System.out.println("ZZZZZ" + z);
                    if (z <= 0) {
                        Double sum = 0 - z;
                        System.out.println("SUMMMMM" + sum);

                        int result = JOptionPane.showConfirmDialog(null, "Det finns inte tillräckligt med material, vill du beställa mer?", "Swing Tester",
                                JOptionPane.YES_NO_OPTION,
                                JOptionPane.QUESTION_MESSAGE);
                        if (result == JOptionPane.YES_OPTION) {
                            registerOrderedMaterial rom = new registerOrderedMaterial(uid);
                            String price = rom.calculatePrice(accessoriesMid, sum.toString());
                            System.out.println("PIRIIIICE" + price);
                            String oid = Database.getAutoIncrement("xorder", "oid");
                            rom.createMaterialOrder(oid, accessoriesMaterials, price, uid);

                            String query = "UPDATE accessories set amount = " + "0.0" + "where mid = " + accessoriesMid;
                            Database.updatePreparedQuery(query);
                        } else if (result == JOptionPane.NO_OPTION) {

                        }
                    } else {
                        String query = "UPDATE accessories set amount = " + z + "where mid = " + accessoriesMid;
                        Database.updatePreparedQuery(query);
                    }
                }

                //Fetches the request (if one is chosen) and deletes it from "requests"
                String selectedRequest = cobRequestsForCustomer.getSelectedItem().toString();
                if (selectedRequest.equals("Inga förfrågningar.")) {
                } else {
                    Database.deleteRow("requests", "rid", selectedRequest);

                }
                JOptionPane.showMessageDialog(null, "Ny beställning skapad!");
            }
        }
    }//GEN-LAST:event_btnConfirmActionPerformed

    private void btnGetRequestInfoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnGetRequestInfoActionPerformed
        //Fetches the description for the selected request item
        String requestID = cobRequestsForCustomer.getSelectedItem().toString();
        if (!requestID.isEmpty()) {
            String requestDescription = Database.fetchSingle("description", "requests", "rid", requestID);
            tfDescription.setText(requestDescription);
            String stockedID = Database.fetchSingle("stocked_product", "requests", "rid", requestID);
            int itemCount = cbStockedProducts.getItemCount();
            if (requestID != null) {
                for (int i = 1; i < itemCount; i++) {
                    System.out.println("HAHA: " + cbStockedProducts.getItemAt(i).toString());
                    String sid = Database.fetchSingle("sid", "stocked_product", "name", cbStockedProducts.getItemAt(i).toString());
                    if (sid.equals(stockedID)) {
                        cbStockedProducts.setSelectedIndex(i);
                    }
                }
            }
        } else {
            tfDescription.setText("");
        }
    }//GEN-LAST:event_btnGetRequestInfoActionPerformed

    private void btnCalculateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCalculateActionPerformed

        calcPriceTotal();

    }//GEN-LAST:event_btnCalculateActionPerformed

    private void calcPriceTotal() {
        HashMap<String, String> fabric = getFabricsWithSize();
        HashMap<String, String> accessories = getAccessoriesWithAmount();
        ArrayList<String> valuesCalc = new ArrayList<>();
        System.out.println(accessories);
        for (String fabrics : fabric.keySet()) {
            for (int i = 0; i < Integer.parseInt(fabric.get(fabrics)); i++) {
                valuesCalc.add(Database.fetchSingle("price", "materials", "name", fabrics));
            }
        }

        for (String fabrics : accessories.keySet()) {
            for (int i = 0; i < Integer.parseInt(accessories.get(fabrics)); i++) {
                valuesCalc.add(Database.fetchSingle("price", "materials", "name", fabrics));
            }
        }
        if (!txtStartingPrice.getText().isEmpty()) {
            valuesCalc.add(txtStartingPrice.getText());
        }
        


        Double timeTaken = Double.parseDouble(tfEstimatedTime.getText().toString());
        Double workSum = timeTaken * Integer.parseInt(hourlyRate);
        valuesCalc.add(workSum.toString());
        
        

        System.out.println(valuesCalc);
        Calculate c = new Calculate();

        
        
        Double finalPrice = c.addNumbers(valuesCalc);
        if (timeTaken <= 2) {
            finalPrice = finalPrice * 1.25;
            lblExpress.setVisible(true);
        } else {
            lblExpress.setVisible(false);
        }
        
        totalPrice = finalPrice.toString();
        txtPriceExMoms.setText(c.calculateMoms(finalPrice.toString()));
        txtEstimatedPrice.setText(finalPrice.toString());
    }

    private void cbStockedProductsItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_cbStockedProductsItemStateChanged
        // TODO add your handling code here:
        String price = Database.fetchSingle("starting_price", "stocked_product", "name", cbStockedProducts.getSelectedItem().toString());
        txtStartingPrice.setText(price);
        String description = Database.fetchSingle("description", "stocked_product", "name", cbStockedProducts.getSelectedItem().toString());
        tfDescription.setText(description);
    }//GEN-LAST:event_cbStockedProductsItemStateChanged

    //Method that fetches the accessories fields and connects them with an amount in a hashMap
    private HashMap<String, String> getAccessoriesWithAmount() {
        ArrayList<JTextField> tfAccessories = new ArrayList<>();
        tfAccessories.add(tfAccessories1);
        tfAccessories.add(tfAccessories2);
        tfAccessories.add(tfAccessories3);
        tfAccessories.add(tfAccessories4);

        ArrayList<JTextField> tfAmounts = new ArrayList<>();
        tfAmounts.add(tfAmount1);
        tfAmounts.add(tfAmount2);
        tfAmounts.add(tfAmount3);
        tfAmounts.add(tfAmount4);

        HashMap<String, String> accessoriesWithAmount = new HashMap<>();

        for (int i = 0; i < tfAccessories.size(); i++) {

            String fabric = tfAccessories.get(i).getText();
            String size = tfAmounts.get(i).getText();

            if (!fabric.isEmpty() && !size.isEmpty()) {
                accessoriesWithAmount.put(fabric, size);
            }
        }
        return accessoriesWithAmount;
    }

    //Method that fetches the fabric fields and connects them with an amount in a hashMap
    private HashMap<String, String> getFabricsWithSize() {
        ArrayList<JTextField> tfFabrics = new ArrayList<>();
        tfFabrics.add(tfFabric1);
        tfFabrics.add(tfFabric2);
        tfFabrics.add(tfFabric3);
        tfFabrics.add(tfFabric4);

        ArrayList<JTextField> tfSizes = new ArrayList<>();
        tfSizes.add(tfSize1);
        tfSizes.add(tfSize2);
        tfSizes.add(tfSize3);
        tfSizes.add(tfSize4);

        HashMap<String, String> fabricsWithSize = new HashMap<>();

        for (int i = 0; i < tfFabrics.size(); i++) {

            String fabric = tfFabrics.get(i).getText();
            String size = tfSizes.get(i).getText();

            if (!fabric.isEmpty() && !size.isEmpty()) {
                fabricsWithSize.put(fabric, size);
            }
        }
        return fabricsWithSize;
    }

    //Fills the comboBox with the existing customers
    private void fillCobCustomers() {
        cobCustomers.addItem("");
        ArrayList<String> emails;
        emails = Database.fetchColumn(false, "email", "customer", "", "");
        for (String email : emails) {
            cobCustomers.addItem(email);
        }
    }

    //Fills the comboBox with customers that have an existing request
    private void fillCobRequestNames() {
        //Empties the description text field and the combobox
        tfDescription.setText("");
        cobRequestsForCustomer.removeAllItems();

        //Fetches the selected customer
        String selectedCustomerEmail = getCustomerEmail();
        ArrayList<String> requests;
        //If a customer is selected the requestbox will be filled with the customer requests that has been approved
        if (!selectedCustomerEmail.isEmpty()) {

            String customerID = Database.fetchSingle("cid", "customer", "email", selectedCustomerEmail);
            requests = Database.fetchColumn(true, "rid", "requests", "customer", customerID + " and review_status = 'J'");
            if (!requests.isEmpty()) {
                for (String requestsID : requests) {
                    cobRequestsForCustomer.addItem(requestsID);
                }
            } else {
                cobRequestsForCustomer.addItem("Inga förfrågningar.");
            }
        } else {
            cobRequestsForCustomer.addItem("Välj en kund");
        }
    }

    private void fillCobStockedProducts() {
        cbStockedProducts.addItem("");
        ArrayList<String> products;
        products = Database.fetchColumn(false, "name", "stocked_product", "", "");
        for (String list : products) {
            cbStockedProducts.addItem(list);
        }
        System.out.println(products);
    }

    private ArrayList<String> getFabricsTf() {
        ArrayList<String> allFabrics = new ArrayList<>();
        ArrayList<String> fabricsWithValue = new ArrayList<>();
        allFabrics.add(tfFabric1.getText());
        allFabrics.add(tfFabric2.getText());
        allFabrics.add(tfFabric3.getText());
        allFabrics.add(tfFabric4.getText());

        for (String fabric : allFabrics) {
            if (!fabric.isEmpty()) {
                fabricsWithValue.add(fabric);
            }
        }

        return fabricsWithValue;
    }

    private ArrayList<String> getAccessoriesTf() {
        ArrayList<String> accessories = new ArrayList<>();
        ArrayList<String> accessoriesWithValue = new ArrayList<>();
        accessories.add(tfAccessories1.getText());
        accessories.add(tfAccessories2.getText());
        accessories.add(tfAccessories3.getText());
        accessories.add(tfAccessories4.getText());

        for (String accessory : accessories) {
            if (!accessory.isEmpty()) {
                accessoriesWithValue.add(accessory);
            }
        }

        return accessoriesWithValue;
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(CreateOrderExistingCustomer.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(CreateOrderExistingCustomer.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(CreateOrderExistingCustomer.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(CreateOrderExistingCustomer.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCalculate;
    private javax.swing.JButton btnConfirm;
    private javax.swing.JButton btnGetRequestInfo;
    private javax.swing.JComboBox<String> cbStockedProducts;
    private javax.swing.JComboBox<String> cobCustomers;
    private javax.swing.JComboBox<String> cobRequestsForCustomer;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel lblAccessories;
    private javax.swing.JLabel lblAddress;
    private javax.swing.JLabel lblAmount;
    private javax.swing.JLabel lblCustomerInfo;
    private javax.swing.JLabel lblCustomers;
    private javax.swing.JLabel lblDescription;
    private javax.swing.JLabel lblEmail;
    private javax.swing.JLabel lblEstimatedTime;
    private javax.swing.JLabel lblExpress;
    private javax.swing.JLabel lblMandatory;
    private javax.swing.JLabel lblMaterial;
    private javax.swing.JLabel lblName;
    private javax.swing.JLabel lblOrderInfo;
    private javax.swing.JLabel lblPhone;
    private javax.swing.JLabel lblPriceExMoms;
    private javax.swing.JLabel lblPriceIncMoms;
    private javax.swing.JLabel lblRequests;
    private javax.swing.JLabel lblRequestsForCustomer;
    private javax.swing.JLabel lblSize;
    private javax.swing.JLabel lblStar;
    private javax.swing.JLabel lblStartingPrice;
    private javax.swing.JTextField tfAccessories1;
    private javax.swing.JTextField tfAccessories2;
    private javax.swing.JTextField tfAccessories3;
    private javax.swing.JTextField tfAccessories4;
    private javax.swing.JTextField tfAddress;
    private javax.swing.JTextField tfAmount1;
    private javax.swing.JTextField tfAmount2;
    private javax.swing.JTextField tfAmount3;
    private javax.swing.JTextField tfAmount4;
    private javax.swing.JTextField tfDescription;
    private javax.swing.JTextField tfEmail;
    private javax.swing.JTextField tfEstimatedTime;
    private javax.swing.JTextField tfFabric1;
    private javax.swing.JTextField tfFabric2;
    private javax.swing.JTextField tfFabric3;
    private javax.swing.JTextField tfFabric4;
    private javax.swing.JTextField tfName;
    private javax.swing.JTextField tfPhone;
    private javax.swing.JTextField tfSize1;
    private javax.swing.JTextField tfSize2;
    private javax.swing.JTextField tfSize3;
    private javax.swing.JTextField tfSize4;
    private javax.swing.JTextField txtEstimatedPrice;
    private javax.swing.JTextField txtPriceExMoms;
    private javax.swing.JTextField txtStartingPrice;
    // End of variables declaration//GEN-END:variables
}
